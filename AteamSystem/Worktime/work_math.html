<html>ref
<head>
	<meta charset="UTF-8">
	<script src="../jQuery.js"></script>
	<link rel="stylesheet" href="../style_v1.css">
	<script src="../DB_sql.js"></script>
</head>
<body>
	<div>
		<button class="button_back" id="BACK_button">æˆ»ã‚‹</button>
		<div class="f">
			<div class="m" style="margin:40 0 0 25 ">ç¤¾å“¡</div>
			<select class="input" style="margin:40 0 0 0 " id="staff_select"><option selected hidden>é¸æŠã—ã¦ãã ã•ã„</option></select>
			<h2 id = "title_month" style="margin:10 0 0 90  ;font-size: 40px" ></h2>   <!--å¹´æœˆé¸æŠç”»é¢ã§å–å¾—ã—ãŸæœˆã‚’è¡¨ç¤º-->
			<h2 style="font-size: 40px; margin: 10px 0; padding: 0 5px;">æœˆå‹¤å‹™æ™‚é–“è¨ˆç®—ç”»é¢</h2>
		</div>
		<div class="f">
			<div class="m">äº¤é€šè²»</div>
			<input class="input" id="road_money_input" type="text"disabled>
		
		
			<div class="m">å‚™è€ƒ</div>
			<input class="input" id="note_input" type="text"disabled>
		</div>
			<button class="button" id="ALL_button">ä¸€æ‹¬</button>
		
	</div>
	<br>
	<table border="1" id="staff_time">
		<tr class="table_bar1"><th rowspan="3"colspan="2">æ—¥ä»˜</th>
			<th rowspan="3">ä½œæ¥­å†…å®¹</th>
			<th rowspan="2" colspan="4">ä½œæ¥­æ™‚é–“å†…è¨³</th>
			<th colspan="4">æ™‚é–“å¤–åŠ´åƒå†…è¨³</th>
			<th rowspan="2" colspan="3">æ™‚é–“å†…è¨³</th>
			<th rowspan="2" colspan="2">ä¼‘æš‡</th>
			<th rowspan="2" colspan="2">æ§é™¤</th>
		</tr>
		<tr class="table_bar2">
			<th colspan="2">å¹³æ—¥ãƒ»åœŸæ›œæ—¥</th><th colspan="2">æ³•å®šä¼‘æ—¥</th>
		</tr>
		<tr class="table_bar3">
			<th>å‡ºå‹¤</th><th>é€€å‹¤</th>
			<th>ä¼‘æ†©</th>
			<th>ç·æ™‚é–“</th>
			<th>é€šå¸¸</th>
			<th>æ·±å¤œ</th>
			<th>é€šå¸¸</th>
			<th>æ·±å¤œ</th>
			<th>è‡ªç¤¾</th>
			<th>å®¢å…ˆ</th>
			<th>ä¼‘æš‡(ä»»æ„)</th>
			<th>æ™‚é–“</th>
			<th>ç¨®åˆ¥</th>
			<th>é…åˆ»</th>
			<th>æ—©é€€</th>
		</tr>
		<!--ã“ã“ã«ãƒ‡ãƒ¼ã‚¿ã‚’appendã§æŒ¿å…¥-->
	</table>
	<div class="f">
		<div>â—†ä½œæ¥­æ™‚é–“ä¸€è¦§</div>
		<div>â—†æ™‚é–“å¤–ä½œæ¥­ä¸€è¦§</div>
	</div>
	
	<div class="f">
		<table border="1">
			<tr><th>å®¢å…ˆæ™‚é–“</th><td id="sum_k_time" style="background-color:#d3d3d3;">0:00</td></tr>
			<tr><th>è‡ªç¤¾æ™‚é–“</th><td id="sum_j_time" style="background-color:#d3d3d3;">0:00</td></tr>
		</table>
		<table border="1">
			<tr>
				<th>å¹³æ—¥ãƒ»åœŸæ›œæ—¥60hä»¥ä¸‹</th>
				<td id="sum_ov_60down" style="background-color:#d3d3d3;">0:00</td>
				<th>æ³•å®šä¼‘æ—¥ä½œæ¥­</th>
				<td id="sum_h_all" style="background-color:#d3d3d3;">0:00</td>
			</tr>
			<tr>
				<th>å¹³æ—¥ãƒ»åœŸæ›œæ—¥60hè¶…é</th>
				<td id="sum_ov_60up" style="background-color:#d3d3d3;">0:00</td>
				<th>æ™‚é–“å¤–ä½œæ¥­ç·æ™‚é–“</th>
				<td id="sum_ov_all" style="background-color:#d3d3d3;">0:00</td>
			</tr>
		</table>
		<button id="MATH_button">è¨ˆç®—</button>
		<button class="button_memory" id="MEMORY_button">ä¿å­˜</button>
	</div>
	
	<!--ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æ™‚ã®ã‚°ãƒ¬ãƒ¼å‡¦ç†-->
	<div id="pop_back"></div>
	
	<!--ä¸€æ‹¬å…¥åŠ›ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—-->
	<div class="pop" id="ALL">
		<button class="pop_cancel" id="ALL_close">âœ–</button>
		<div class="pop_title">ä¸€æ‹¬å…¥åŠ›</div>
		<div class="pop_input_group">
			<label>å‡ºå‹¤æ™‚é–“</label>
			<input class="pop_input" id="ALL_start" type="time">
		</div>
		<div class="pop_input_group">
			<label>é€€å‹¤æ™‚é–“</label>
			<input class="pop_input" id="ALL_finish" type="time">
		</div>
		<div class="pop_button_group">
			<button class="pop_button" id="customer_button" style="background-color: #FFD700;">å®¢å…ˆ</button>
			<button class="pop_button" id="commpany_button" style="background-color: #87CEEB;">è‡ªç¤¾</button>
		</div>
	</div>
	
		<!--ä¿å­˜ç¢ºèªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—-->
	<div class="pop" id="MEMORY">
		<button class="pop_cancel" id="MEMORY_close">âœ–</button>
		<div class="pop_title_alone">ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ</div>
		<button class="pop_button_alone" id="MEMORY_OK">OK</button>
	</div>
	
	<!--æˆ»ã‚‹ç¢ºèªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—-->
	<div class="pop" id="BACK">
		<button class="pop_cancel" id="BACK_close">âœ–</button>
		<div class="pop_title_memorycheck">
			<span style="color: red;">â€»ä¿å­˜ã—ã¦ã„ãªã„ãŸã‚<br>å…¥åŠ›ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¾ã™<br></span>ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ
		</div>
		<button class="pop_button_alone" id="BACK_OK">OK</button>
	</div>
</body>
<script>

let check = 0;
let select_check = false;
	//ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒãƒƒã‚¯ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
	window.addEventListener('load', function() {
	  window.addEventListener('popstate', function(event) {
	    alert('ã‚‚ã†ä¸€åº¦ã“ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ä¿å­˜ã—ã¦ã„ãªã„ãƒ‡ãƒ¼ã‚¿ã¯æ¶ˆãˆã¦ã—ã¾ã„ã¾ã™ğŸ˜±');
	  });
	  history.pushState(null, null, null);
	});
	

	
	//ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®hideå‡¦ç†
	$("#ALL").hide();
	$("#MEMORY").hide();
	$("#BACK").hide();
	$("#pop_back").hide();
	
	//å¹´æœˆé¸æŠç”»é¢ã‹ã‚‰å¤‰æ•°ã‚’å–å¾—
	 let cash_year = localStorage.getItem("year");
	 let cash_month = localStorage.getItem("month");
	
	let year = cash_year;
	let month = cash_month;
	if(month.length==1){
		month = "0"+month;
	}
	
     //ã‚¿ã‚¤ãƒˆãƒ«ã®é ­ã«æœˆã‚’è¿½åŠ 
      $("#title_month").append(cash_month);
     	 
	//DBã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
	let sql_select_day = 'select * from TP_Calendar where date LIKE "'+year+'-'+month+'%"';
	let DBsql_select_day = DB.sql(sql_select_day);
	
	let sql_select_time = 'select * from TE_Time where date LIKE "'+year+'-'+month+'%"';
	let DBsql_select_time = DB.sql(sql_select_time);
	
	let sql_select_staff_name = 'select staff_id,staff_name from TM_Staff where del_flg="0"';
	let DBsql_select_staff_name = DB.sql(sql_select_staff_name);
	
	let DBsql_holiday_type = DB.sql("select * from TC_HolidayType");
	
	let DBsql_time = DB.sql("select staff_id,date from TE_Time");
	
	let DBsql_table_column = DB.sql("desc TE_Time");

	//ç¤¾å“¡ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã«ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥
	for(i=0;i<DBsql_select_staff_name.length;i++){
		$("#staff_select").append('<option id="staff_select'+i+'"></option>');
		$("#staff_select"+i).text(DBsql_select_staff_name[i]["staff_id"]+"ï¼š"+DBsql_select_staff_name[i]["staff_name"]);
	};
	
	//ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠæ™‚
	$("#staff_select").on("change",function(){
		select_check = true;
		let DB_name = $(this).children(':selected').text();
		let name = DB_name.slice(7,40);
		let name_id_slice = DB_name.slice(0,6);
		let sql_select_time = 'select staff_name,work_content,start_time,end_time,break_time,overtime_normal,overtime_night,overtime_nosat,overtime_nosat_night,private_time,customer_time,break_time_any,holiday_time,holiday_type,slow,early from TE_Time join TM_Staff on TE_Time.staff_id=TM_Staff.staff_id where date LIKE "'+year+'-'+month+'%"AND staff_name LIKE "'+name+'" ';
		let DBsql_select_time = DB.sql(sql_select_time);
		let sql_road_money = 'select road_money,note from TE_Staff_Location where staff_id="'+name_id_slice+'" AND del_flg = "0" ';
		console.log(sql_road_money)
		let DBsql_road_money = DB.sql(sql_road_money);
		console.log(DBsql_road_money);
		
		if(DBsql_road_money.length>0){
			if(DBsql_road_money.length>1){
				$("#road_money_input").val("äºŒä»¶ä»¥ä¸Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™");
				
			}else{
				$("#road_money_input").val(DBsql_road_money[0]["road_money"]);
				$("#note_input").val(DBsql_road_money[0]["note"]);
			}
		}else{
			$("#road_money_input").val("-");
			$("#note_input").val("-");
		}
		
		//DBã®ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹ç”¨ã®å¤‰æ•°ã¨åˆæœŸåŒ–
		var memory = new Array(DBsql_select_time.length);
		for(i=0;i<DBsql_select_time.length;i++){
			memory[i] = new Array(16);
			for(j=0;j<16;j++){
				memory[i][j] = "00:00";
				if(j==0){
					memory[i][j] = "-";
				}
				if(j==13){
					memory[i][j] = "-";
				}
			}
		}
		for(i=0;i<memory.length;i++){
			memory[i][0] = DBsql_select_time[i]["work_content"];
			let db_slice = DBsql_select_time[i]["start_time"];
			memory[i][1] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["end_time"];
			memory[i][2] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["break_time"];
			memory[i][3] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["overtime_normal"];
			memory[i][5] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["overtime_night"];
			memory[i][6] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["overtime_nosat"];
			memory[i][7] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["overtime_nosat_night"];
			memory[i][8] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["private_time"];
			memory[i][9] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["customer_time"];
			memory[i][10] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["break_time_any"];
			memory[i][11] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["holiday_time"];
			memory[i][12] = db_slice.slice(0,5);
			memory[i][13] = DBsql_select_time[i]["holiday_type"];
			db_slice = DBsql_select_time[i]["slow"];
			memory[i][14] = db_slice.slice(0,5);
			db_slice = DBsql_select_time[i]["early"];
			memory[i][15] = db_slice.slice(0,5);
		}
		
		//ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’appendã§å…¥ã‚Œè¾¼ã‚€
		for(i=0;i<calendar_day.length;i++){
			if(check==0){
				$("#staff_time").append('<tr id="staff_row'+i+'"></tr>');
				$("#staff_row"+i).append('<td id="staff_day'+i+'" style="background-color:#d3d3d3;"></td>');
				$("#staff_row"+i).append('<td id="staff_week'+i+'" style="background-color:#d3d3d3;"></td>');
			}
			$("#staff_day"+i).text(calendar_day[i][1]);
			$("#staff_week"+i).text(calendar_day[i][2]);
			for(j=0;j<16;j++){
				if(check==0){
					if(j!=4&&j!=13){
						$("#staff_row"+i).append('<td><input id="staff_data'+i+'_'+j+'" type="text"></td>');
					}else if(j==4){
						$("#staff_row"+i).append('<td><input id="staff_data'+i+'_'+j+'" type="text" disabled></td>');
					}else if(j==13){
						$("#staff_row"+i).append('<td><select id="staff_data'+i+'_'+j+'" ><option id="holiday_type'+i+'99" selected style="display:inlin;text-align:center;">-</option></select></td>');
						for(k=0;k<DBsql_holiday_type.length;k++){
							if(DBsql_holiday_type[k]["holiday_type_name"]!="-"){
								$("#staff_data"+i+"_"+j).append('<option id="holiday_type'+i+''+DBsql_holiday_type[k]["holiday_type"]+'"></option>');
								$("#holiday_type"+i+DBsql_holiday_type[k]["holiday_type"]).text(DBsql_holiday_type[k]["holiday_type_name"]);
							}
						}
					}
				}
				if(j!=0&&j!=13){
					$("#staff_data"+i+"_"+j).val("00:00");
				}
				if(j==13){
					$("#holiday_type"+i+"99").prop("selected", true); 
				}
				if(j==0){
					$("#staff_data"+i+"_"+j).val("-");
				}
				if(j!=0){
					$("#staff_data"+i+"_"+j).css('width','50');
				}
			}
			$("#staff_data"+i+"_0").val("-");
			$("#staff_data"+i+"_0").css('background-color','yellow');
			$("#staff_data"+i+"_1").css('background-color','yellow');
			$("#staff_data"+i+"_2").css('background-color','yellow');
			$("#staff_data"+i+"_4").css('background-color','#d3d3d3');
			$("#staff_data"+i+"_9").css('background-color','yellow');
			$("#staff_data"+i+"_10").css('background-color','yellow');
			if(DBsql_select_day[i]["wday"]=="åœŸ"){
				$("#staff_data"+i+"_0").css('background-color','white');
				$("#staff_data"+i+"_1").css('background-color','white');
				$("#staff_data"+i+"_2").css('background-color','white');
				$("#staff_data"+i+"_9").css('background-color','white');
				$("#staff_data"+i+"_10").css('background-color','white');
				$("#staff_day"+i).css('background-color','blue');
				$("#staff_week"+i).css('background-color','blue');
			}else if(DBsql_select_day[i]["holiday_flg"]==1){
				$("#staff_data"+i+"_0").css('background-color','white');
				$("#staff_data"+i+"_1").css('background-color','white');
				$("#staff_data"+i+"_2").css('background-color','white');
				$("#staff_data"+i+"_9").css('background-color','white');
				$("#staff_data"+i+"_10").css('background-color','white');
				$("#staff_day"+i).css('background-color','red');
				$("#staff_week"+i).css('background-color','red');
			}else if(DBsql_select_day[i]["wday"]=="æ—¥"){
				$("#staff_data"+i+"_0").css('background-color','white');
				$("#staff_data"+i+"_1").css('background-color','white');
				$("#staff_data"+i+"_2").css('background-color','white');
				$("#staff_data"+i+"_9").css('background-color','white');
				$("#staff_data"+i+"_10").css('background-color','white');
				$("#staff_day"+i).css('background-color','red');
				$("#staff_week"+i).css('background-color','red');
			}
		}
		//DBã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥
		for(i=0;i<memory.length;i++){
			for(j=0;j<16;j++){
				if(j!=13){
					$("#staff_data"+i+"_"+j).val(memory[i][j]);
				}else{
					$("#holiday_type"+i+memory[i][j]).prop("selected", true); 
				}
			}
		}
		if(check==0){
		//ç·åˆè¨ˆã‚’appendã§å…¥ã‚Œè¾¼ã‚€
		$("#staff_time").append('<tr class="table_bar4"><th colspan="6">ç·æ™‚é–“</th>'+
								'<td id="sum_all"style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_ovt_n" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_ovt_e" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_ovt_h_n" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_ovt_h_e" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_commpany" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_customer" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_break" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_h_time" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td style="text-align: center;background-color:#d3d3d3;">ï¼</td>'+
								'<td id="sum_slow"  style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td>'+
								'<td id="sum_early" style="width:50;font-size:13;background-color:#d3d3d3;">00:00</td></tr>');
		}
		check++;
	});
	
	//ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ—¥ä»˜ã¨æ›œæ—¥ã‚’é…åˆ—ã«æ ¼ç´
	var calendar_day = new Array (DBsql_select_day.length);
	for(i=0;i<calendar_day.length;i++){
		calendar_day[i] = new Array(2);
		let day = DBsql_select_day[i]["date"];
		calendar_day[i][1] = day.slice(8,10);
		calendar_day[i][2] = DBsql_select_day[i]["wday"];
	}
	
	//ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†
	var error_check = new Array(calendar_day);
	for(i=0;i<calendar_day.length;i++){
		error_check[i] = new Array(16);
		for(j=0;j<16;j++){
			error_check[i][j] = false;
		}
	}

	//ãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ‡ãƒ¼ã‚¿å…¥åŠ›æ™‚
//	$("input").on("input", function() {
//		apdate_sum();
//	});
	
	//è¨ˆç®—ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#MATH_button").on("click",function(){
		if(select_check){
			for(i=0;i<calendar_day.length;i++){
				for(j=0;j<16;j++){
					error_check[i][j] = false;
				}
			}
			apdate_sum();
		}else{
			alert("ç¤¾å“¡ã‚’é¸æŠã—ã¦ãã ã•ã„");
		}
	});
	
	//ä¸€æ‹¬ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#ALL_button").on("click",function(){
		if(select_check){
			$("#ALL").show();
			$("#pop_back").show();
		}else{
			alert("ç¤¾å“¡ã‚’é¸æŠã—ã¦ãã ã•ã„");
		}
	})
	
	//ä¸€æ‹¬å…¥åŠ›ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
	//ä¸€æ‹¬å…¥åŠ›é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#ALL_close").on("click",function(){
		$("#ALL").hide();
		$("#pop_back").hide();
	})
	
	//ä¸€æ‹¬å…¥åŠ›å®¢å…ˆãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#customer_button").on("click",function(){
		let ALL_start = $("#ALL_start").val();
		let ALL_finish = $("#ALL_finish").val();
		let time_start = time(ALL_start);
		let time_finish = time(ALL_finish);
		let time_h = Math.floor((time_finish - time_start)/60);
		let time_m = (time_finish - time_start)%60;
		let ALL_time = "";
		ALL_time = zero(time_h,time_m,time_finish,time_start);
		for(i=0;i<calendar_day.length;i++){
			$("#staff_data"+i+"_1").val(ALL_start);
			$("#staff_data"+i+"_2").val(ALL_finish);
			$("#staff_data"+i+"_9").val("00:00");
			$("#staff_data"+i+"_10").val(ALL_time);
		}
		$("#ALL").hide();
		$("#pop_back").hide();
		apdate_sum();
	})
	
	//ä¸€æ‹¬å…¥åŠ›è‡ªç¤¾ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#commpany_button").on("click",function(){
		let ALL_start = $("#ALL_start").val();
		let ALL_finish = $("#ALL_finish").val();
		let time_start = time(ALL_start);
		let time_finish = time(ALL_finish);
		let time_h = Math.floor((time_finish - time_start)/60);
		let time_m = (time_finish - time_start)%60;
		let ALL_time = "";
		ALL_time = zero(time_h,time_m,time_finish,time_start);
		for(i=0;i<calendar_day.length;i++){
			$("#staff_data"+i+"_1").val(ALL_start);
			$("#staff_data"+i+"_2").val(ALL_finish);
			$("#staff_data"+i+"_9").val(ALL_time);
			$("#staff_data"+i+"_10").val("00:00");
		}
		$("#ALL").hide();
		$("#pop_back").hide();
		apdate_sum();
	})
	
	//æˆ»ã‚‹ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#BACK_button").on("click",function(){
		$("#BACK").show();
		$("#pop_back").show();
	})
	
	//æˆ»ã‚‹ç¢ºèªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#BACK_close").on("click",function(){
		$("#BACK").hide();
		$("#pop_back").hide();
	})

	//æˆ»ã‚‹ç¢ºèªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#BACK_OK").on("click",function(){
		$("#BACK").hide();
		$("#pop_back").hide();
		// é¸æŠç”»é¢ã¸
		location.href = "../Date_Selection/ym_selet.html";
	})

	
	//ä¿å­˜ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#MEMORY_button").on("click",function(){
		if(select_check){
			$("#MEMORY").show();
			$("#pop_back").show();
		}else{
			alert("ç¤¾å“¡ã‚’é¸æŠã—ã¦ãã ã•ã„");
		}
	})
	
	//ä¿å­˜ç¢ºèªé–‰ã˜ã‚‹ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#MEMORY_close").on("click",function(){
		$("#MEMORY").hide();
		$("#pop_back").hide();
	})
	
	//ä¿å­˜ç¢ºèªOKãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚
	$("#MEMORY_OK").on("click",function(){
		DBsql_time = DB.sql("select staff_id,date from TE_Time");
		let save = new Array(calendar_day.length);
		let day = 0;
		for(i=0;i<calendar_day.length;i++){
			day++;
			save[i] = new Array(17);
			let name = $("#staff_select").children(':selected').text();
			save[i][0] = name.slice(0,6);
			if(i<9){
				save[i][1] = year+"-"+month+"-0"+day;
			}else{
				save[i][1] = year+"-"+month+"-"+day;
			}
			save[i][2] = $("#staff_data"+i+"_0").val();
			save[i][3] = $("#staff_data"+i+"_1").val();
			save[i][4] = $("#staff_data"+i+"_2").val();
			save[i][5] = $("#staff_data"+i+"_3").val();
			save[i][6] = $("#staff_data"+i+"_5").val();
			save[i][7] = $("#staff_data"+i+"_6").val();
			save[i][8] = $("#staff_data"+i+"_7").val();
			save[i][9] = $("#staff_data"+i+"_8").val();
			save[i][10] = $("#staff_data"+i+"_9").val();
			save[i][11] = $("#staff_data"+i+"_10").val();
			save[i][12] = $("#staff_data"+i+"_11").val();
			save[i][13] = $("#staff_data"+i+"_12").val();
			let holidaytype = $("#staff_data"+i+"_13").children(':selected').text();
			for(j=0;j<DBsql_holiday_type.length;j++){
					if(holidaytype==DBsql_holiday_type[j]["holiday_type_name"]){
						save[i][14] = DBsql_holiday_type[j]["holiday_type"];
					}
			}
			save[i][15] = $("#staff_data"+i+"_14").val();
			save[i][16] = $("#staff_data"+i+"_15").val();
		}
		for(i=0;i<save.length;i++){
			let update_check = false;
			for(j=0;j<DBsql_time.length;j++){
				if(save[i][0]==DBsql_time[j]["staff_id"]&&save[i][1]==DBsql_time[j]["date"]){
					update_check=true;
				}
			}
			if(update_check){
				
				let sql_update = "UPDATE TE_Time SET "
				for(k=2;k<17;k++){
					if(k==2){
						sql_update += DBsql_table_column[k]["Field"] + ' = "' + save[i][k] + '"'
					}else{
						sql_update += ',' + DBsql_table_column[k]["Field"] + ' = "' + save[i][k] + '"'
					}
				}
				sql_update += ' where staff_id = "'+save[i][0]+'" AND date = "'+save[i][1]+'";'
				console.log(sql_update)
				DB.sql(sql_update);
			}else{
				let sql_insert = "INSERT INTO TE_Time VALUE ("
				for(k=0;k<17;k++){
					if(k==0){
						sql_insert += '"' + save[i][k] + '"'
					}else{
						sql_insert += ',"' + save[i][k] + '"'
					}
				}
				sql_insert += ');'
				console.log(sql_insert)
				DB.sql(sql_insert);
			}
		}
		$("#MEMORY").hide();
		$("#pop_back").hide();
	})
	
	
//-------------------------------------ã“ã“ã‹ã‚‰functionã ã‚ˆ----------------------------------------------------------------------------------
	
	
	//timeå‹ã®hh:mmã®hhã‚’å–ã‚Šå‡ºã—ã¦intå‹ã«å¤‰æ›
	function time(time){
		//æ™‚é–“ã®è¨ˆç®—
		let time_h;
		if(time.length == 5){
			time_h = time.slice(0,2);
		}else if(time.length == 4){
			time_h = time.slice(0,1);
		}
			time_h = time_h * 60;
		let time_h_trans = parseInt(time_h)
		//åˆ†ã®è¨ˆç®—
		let time_m;
		if(time.length == 5){
			time_m = time.slice(3,5);
		}else if(time.length == 4){
			time_m = time.slice(2,4);
		}
		let time_m_trans = parseInt(time_m)
		
		let time_sum = time_m_trans + time_h_trans;
		
		return time_sum;
	}
	
	//timeå‹ã‹ã‚‰ã®å¤‰æ›å¾Œã®0åŸ‹ã‚
	function zero(time_h,time_m,time_finish,time_start){
		let time;
		if(time_h.toString().length==1){
			time = "0"+time_h+":"+time_m;
		}
		if(time_m.toString().length==1){
			time = time_h+":0"+time_m;
		}
		if(time_h.toString().length==1&&time_m.toString().length==1){
			time = "0"+time_h+":0"+time_m;
		}
		if(time_h.toString().length==2&&time_m.toString().length==2){
			time = time_h+":"+time_m;
		}
		if(time_finish - time_start<0){
			time = "error";
		}
		return time;
	}
	
	//å‡ºå‹¤æ™‚é–“ã¨é€€å‹¤æ™‚é–“ã®å…¥åŠ›å†…å®¹ã‚’ã‚‚ã¨ã«ç·æ™‚é–“ã‚’è‡ªå‹•è¨ˆç®—
	function apdate_sum(){
		for(i=0;i<calendar_day.length;i++){
			let start_time = $("#staff_data"+i+"_1").val();
			let finish_time = $("#staff_data"+i+"_2").val();
			let break_time = $("#staff_data"+i+"_3").val();
			start_time = time(start_time);
			finish_time = time(finish_time);
			break_time = time(break_time);
			let sum_h = Math.floor(((finish_time - start_time) - break_time)/60);
			let sum_m = ((finish_time - start_time) - break_time)%60;
			let sum_time = zero(sum_h,sum_m,finish_time,start_time);
			$("#staff_data"+i+"_4").val(sum_time);
			//ç·åˆè¨ˆã¨å®¢å…ˆ+è‡ªç¤¾ã®å€¤ãŒç•°ãªã‚‹ã¨ãã®ã‚¨ãƒ©ãƒ¼
			let sum_check = $("#staff_data"+i+"_4").val();
			let commpany_check = $("#staff_data"+i+"_9").val();
			let customr_check = $("#staff_data"+i+"_10").val();
			if(time(sum_check) == time(commpany_check)+time(customr_check)){
				$("#staff_data"+i+"_9").css('background-color', 'yellow');
				$("#staff_data"+i+"_10").css('background-color', 'yellow');
			}else{
				$("#staff_data"+i+"_9").css('background-color', 'red');
				$("#staff_data"+i+"_10").css('background-color', 'red');
				error_check[i][9] = true;
				error_check[i][10] = true;
			}
		}
		//ç·åˆè¨ˆã®ç·åˆè¨ˆ
		Asum("4","sum_all");
		//å¹³æ—¥ãƒ»åœŸæ›œã®æ®‹æ¥­æ™‚é–“ã®åˆè¨ˆ(é€šå¸¸)
		Asum("5","sum_ovt_n");
		//å¹³æ—¥ãƒ»åœŸæ›œã®æ®‹æ¥­æ™‚é–“ã®åˆè¨ˆ(æ·±å¤œ)
		Asum("6","sum_ovt_e");
		//æ³•å®šä¼‘æ—¥ã®æ®‹æ¥­æ™‚é–“ã®åˆè¨ˆ(é€šå¸¸)
		Asum("7","sum_ovt_h_n");
		//æ³•å®šä¼‘æ—¥ã®æ®‹æ¥­æ™‚é–“ã®åˆè¨ˆ(æ·±å¤œ)
		Asum("8","sum_ovt_h_e");
		//è‡ªç¤¾ã®ç·åˆè¨ˆã‚’æ±‚ã‚ã‚‹
		Asum("9","sum_commpany");
		//å®¢å…ˆã®ç·åˆè¨ˆã‚’æ±‚ã‚ã‚‹
		Asum("10","sum_customer");
		//ä¼‘æ†©æ™‚é–“ã®ç·åˆè¨ˆ
		Asum("11","sum_break");
		//ä¼‘æš‡æ™‚é–“ã®ç·åˆè¨ˆ
		Asum("12","sum_h_time");
		//é…åˆ»æ™‚é–“ã®ç·åˆè¨ˆ
		Asum("14","sum_slow");
		//æ—©é€€æ™‚é–“ã®ç·åˆè¨ˆ
		Asum("15","sum_early");
		//ä½œæ¥­ä¸€è¦§ã®å®¢å…ˆæ™‚é–“ã®åˆè¨ˆ
		Asum("10","sum_k_time");
		//ä½œæ¥­ä¸€è¦§ã®è‡ªç¤¾æ™‚é–“ã®åˆè¨ˆ
		Asum("9","sum_j_time");
		//å¹³æ—¥ãƒ»åœŸæ›œã®æ®‹æ¥­æ™‚é–“ã®60æ™‚é–“è¶…éã¨ã€ä»¥ä¸‹ã®è¡¨ç¤º
		let sum_ov60_n = Asum_r("5");
		let sum_ov60_e = Asum_r("6");
		let sum_ov60_n_int = time(sum_ov60_n);
		let sum_ov60_e_int = time(sum_ov60_e);
		let sum_ov60_int = sum_ov60_n_int + sum_ov60_e_int;
		if(sum_ov60_int>3600){
			$("#sum_ov_60down").text("60:00");
			let sum_ov60up_h = Math.floor((sum_ov60_int - 3600)/60);
			let sum_ov60up_m = (sum_ov60_int - 3600)%60;
			let sum_ov_60up = zero(sum_ov60up_h,sum_ov60up_m,0,0);
			$("#sum_ov_60up").text(sum_ov_60up);
		}else{
			$("#sum_ov_60up").text("00:00");
			let sum_ov60down_h = Math.floor((sum_ov60_int)/60);
			let sum_ov60down_m = (sum_ov60_int)%60;
			let sum_ov_60down = zero(sum_ov60down_h,sum_ov60down_m,0,0);
			$("#sum_ov_60down").text(sum_ov_60down);
		}
		//æ³•å®šä¼‘æ—¥ã®åˆè¨ˆ
		let sum_ov_h_n = Asum_r("7");
		let sum_ov_h_e = Asum_r("8");
		let sum_ov_h_n_int = time(sum_ov_h_n);
		let sum_ov_h_e_int = time(sum_ov_h_e);
		let sum_ov_h = sum_ov_h_n_int + sum_ov_h_e_int;
		let sum_ov_h_h = Math.floor((sum_ov_h)/60);
		let sum_ov_h_m = (sum_ov_h)%60;
		let sum_ov_h_text = zero(sum_ov_h_h,sum_ov_h_m,0,0);
		$("#sum_h_all").text(sum_ov_h_text);
		//æ™‚é–“å¤–ä½œæ¥­ç·æ™‚é–“
		let sum_ov_all_int = sum_ov60_int + sum_ov_h;
		let sum_ov_all_h = Math.floor((sum_ov_all_int)/60);
		let sum_ov_all_m = (sum_ov_all_int)%60;
		let sum_ov_all = zero(sum_ov_all_h,sum_ov_all_m,0,0);
		$("#sum_ov_all").text(sum_ov_all);
		//å…¥åŠ›ã•ã‚ŒãŸå€¤ãŒ24ä»¥ä¸Šã ã£ãŸå ´åˆã®ã‚¨ãƒ©ãƒ¼
		error(1);
		error(2);
		error(3);
		error(5);
		error(6);
		error(7);
		error(8);
		error(9);
		error(10);
		error(11);
		error(12);
		error(14);
		error(15);
//		text_error(1);
//		text_error(2);
//		text_error(3);
//		text_error(5);
//		text_error(6);
//		text_error(7);
//		text_error(8);
//		text_error(9);
//		text_error(10);
//		text_error(11);
//		text_error(12);
//		text_error(14);
//		text_error(15);

	}
	
	//ç·åˆè¨ˆã‚’æ±‚ã‚ã‚‹
	function Asum(type,view){
		let sum_all_save=0;
		for(i=0;i<calendar_day.length;i++){
			let sum_all = $("#staff_data"+i+"_"+type).val();
			let sum_all_int = time(sum_all);
			sum_all_save += sum_all_int;
		}
		let sum_all_h = Math.floor(sum_all_save/60);
		let sum_all_m = (sum_all_save%60);
		sum_all_text = zero(sum_all_h,sum_all_m,0,0);
		$("#"+view).text(sum_all_text);
	}
	
	//ç·åˆè¨ˆã‚’æ±‚ã‚ã‚‹(returnç”¨)
	function Asum_r(type){
		let sum_all_save=0;
		for(i=0;i<calendar_day.length;i++){
			let sum_all = $("#staff_data"+i+"_"+type).val();
			let sum_all_int = time(sum_all);
			sum_all_save += sum_all_int;
		}
		let sum_all_h = Math.floor(sum_all_save/60);
		let sum_all_m = (sum_all_save%60);
		sum_all_text = zero(sum_all_h,sum_all_m,0,0);
		return sum_all_text;
	}
	
	//24ä»¥ä¸Šã‚‚ã—ãã¯ãƒã‚¤ãƒŠã‚¹ã®å€¤ã®æ™‚ã®ã‚¨ãƒ©ãƒ¼
	function error(type){
		for(i=0;i<calendar_day.length;i++){
			let ov_check = $("#staff_data"+i+"_"+type).val();
			ov_check_int = time(ov_check);
			if(ov_check_int>1440){
				$("#staff_data"+i+"_"+type).css('background-color','red');
				error_check[i][type]=true;
			}else{
				if(type==1||type==2||type==9||type==10){
					if(type==1||type==2){
						$("#staff_data"+i+"_"+type).css('background-color','yellow');
					}else if(error_check[i][type]!=true){
						$("#staff_data"+i+"_"+type).css('background-color','yellow');
					}
				}else{
					$("#staff_data"+i+"_"+type).css('background-color','white');
				}
			}
		}
	}
	
	//æ›¸ãæ–¹ãŒãŠã‹ã—ã„æ™‚ã®ã‚¨ãƒ©ãƒ¼
//	function text_error(type){
//		let text_check_error_left = false;
//		let text_check_error_right = false;
//		for(i=0;i<calendar_day.length;i++){
//			let text = $("#staff_data"+i+"_"+type).val();
//			let text_left = text.slice(0,2);
//			let text_center = text.slice(2,3);
//			let text_right = text.slice(3,5);
//			if(text_center!=":"){
//				$("#staff_data"+i+"_"+type).css('background-color','red');
//				error_check[i][type]=true;
//			}else{
//				if(type==1||type==2||type==9||type==10){
//					if(error_check[i][type]!=true){
//						$("#staff_data"+i+"_"+type).css('background-color','yellow');
//					}
//				}else{
//					if(error_check[i][type]!=true){
//						$("#staff_data"+i+"_"+type).css('background-color','white');
//					}
//				}
//			}
//			for(i=0;i<=24;i++){
//				if(i.length==1){
//					let text_check_length = "0"+i;
//				}else{
//					let text_check_length = i;
//				}
//				if(text_left==text_check_length){
//					text_check_error_left=true;
//				}
//			}
//			
//			if(text_check_error_left==false){
//				$("#staff_data"+i+"_"+type).css('background-color','red');
//				error_check[i][type]=true;
//			}
//			
//			for(i=0;i<60;i++){
//				if(i.length==1){
//					let text_check_length = "0"+i;
//				}else{
//					let text_check_length = i;
//				}
//				if(text_right==text_check_length){
//					text_check_error_right=true;
//				}
//			}
//			if(text_check_error_right==false){
//				$("#staff_data"+i+"_"+type).css('background-color','red');
//				error_check[i][type]=true;
//			}
//			
//		}
//	}
	
</script>

</html>

